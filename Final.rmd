---
title: "Covid91 vaccine study Final2024"
author: "Damian Earp"
output: 
  html_document:
    number_sections: true
    toc: true
    toc_depth: 5
date: "`r Sys.Date()`" 
---

```{r include=FALSE,echo=FALSE}
require(tidyverse)
require(tigerstats)
require(forcats)
FinalDat <-read.csv(file="finalSumr2024.csv",header=TRUE)
#recode to remove the annoying "X" from the dataframe
FinalData <- FinalDat  %>% select(-one_of("X"))
FinalData <- FinalData %>%
mutate(across(where(is.character), as.factor))
M = filter(FinalData, sex =="M")
F = filter(FinalData, sex =="F")
LGBTQ = filter(FinalData, LGBTQ =="gay")
DrugUser = filter(FinalData, DrugUser =="yes")
```

# Introduction

A new  preventative vaccine (covid921) is under test in clinical trials. Given the nature of this vaccine it is suspected that the drug may exhibit different effectiveness across the variety of subpopulations tracked. Consider population subgroups by gender( guys and gals), drug use, and sexual orientation. Write a complete report that separately considers this drug for each subgroup and your recommendations as to whether people in the subgroup should take the vaccine. Structure your report in four sections each devoted to one of the four subgroups, use null and alternative hypothesis statements and correct statistical verbage when referencing p-values in conclusions.



## Males

```{r}
dd2 <- M %>% group_by(infected,treatment) %>% summarize(count=n()) %>% mutate(prcnt=count/sum(count))


# the group_by followed by summarize(count=n())

basicC <- ggplot(dd2,aes(x=infected,y=count,fill=treatment))
basicC + geom_bar(stat="identity",position="dodge")

#Now for percentage plot

basicCC <- ggplot(dd2,aes(x=infected,y=prcnt*100,fill=treatment)) 
basicCC + geom_bar(stat="identity", position = "dodge")
```

From the graph above on guy count, we can see a clear difference in the count of people who were infected when taking the placebo vs the vaccine, comparing who had covid, we can say the vaccine is working!

on the percentage graph we can see that more that two thirds the guys that took the placebo still got covid compared to the guys that took the vaccine.

### Numerical resuts (Male)

```{r}
table1 <- xtabs(~infected + treatment, data=M)
rowPerc(table1)
colPerc(table1)
```

### Inferential (Male)

```{r}
chisq.test(table1)
chisqtestGC(table1)
Mfish <- fisher.test(table1)
Mfish
```

## Females

```{r}
dd2 <- F %>% group_by(infected,treatment) %>% summarize(count=n()) %>% mutate(prcnt=count/sum(count))


# the group_by followed by summarize(count=n())

basicC <- ggplot(dd2,aes(x=infected,y=count,fill=treatment))
basicC + geom_bar(stat="identity",position="dodge")

#Now for percentage plot

basicCC <- ggplot(dd2,aes(x=infected,y=prcnt*100,fill=treatment)) 
basicCC + geom_bar(stat="identity", position = "dodge")
```

I'm not surprised when I look above at our data on the gals, its almost identical to the guys! However looking at the percentage it looks like half the gals who took placebo still got infected compared to the gals that took the vaccine.

### Numerical resuts (Female)

```{r}
table1 <- xtabs(~infected + treatment, data=F)
rowPerc(table1)
colPerc(table1)
```

### Inferential (Female)

```{r}
chisq.test(table1)
chisqtestGC(table1)
Ffish <- fisher.test(table1)
Ffish
```

## LGBTQ

```{r}
dd2 <- LGBTQ %>% group_by(infected,treatment) %>% summarize(count=n()) %>% mutate(prcnt=count/sum(count))


# the group_by followed by summarize(count=n())

basicC <- ggplot(dd2,aes(x=infected,y=count,fill=treatment))
basicC + geom_bar(stat="identity",position="dodge")

#Now for percentage plot

basicCC <- ggplot(dd2,aes(x=infected,y=prcnt*100,fill=treatment)) 
basicCC + geom_bar(stat="identity", position = "dodge")
```

### Numerical resuts (LGBTQ)

```{r}
table1 <- xtabs(~infected + treatment, data=LGBTQ)
rowPerc(table1)
colPerc(table1)
```

### Inferential (LGBTQ)

```{r}
chisq.test(table1)
chisqtestGC(table1)
LGBTQfish <- fisher.test(table1)
LGBTQfish
```

## Druggies

```{r}
dd2 <- DrugUser %>% group_by(infected,treatment) %>% summarize(count=n()) %>% mutate(prcnt=count/sum(count))


# the group_by followed by summarize(count=n())

basicC <- ggplot(dd2,aes(x=infected,y=count,fill=treatment))
basicC + geom_bar(stat="identity",position="dodge")

#Now for percentage plot

basicCC <- ggplot(dd2,aes(x=infected,y=prcnt*100,fill=treatment)) 
basicCC + geom_bar(stat="identity", position = "dodge")
```

### Numerical resuts (DrugUser)

```{r}
table1 <- xtabs(~infected + treatment, data=DrugUser)
rowPerc(table1)
colPerc(table1)
```

### Inferential (DrugUser)

```{r}
chisq.test(table1)
chisqtestGC(table1)
DrugUserfish <- fisher.test(table1)
DrugUserfish
```


# Overall Results and Conclusions