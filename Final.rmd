---
title: "Covid91 vaccine study Final2024"
author: "Damian Earp"
output: 
  html_document:
    number_sections: true
    toc: true
    toc_depth: 5
date: "`r Sys.Date()`" 
---

```{r include=FALSE,echo=FALSE}
require(tidyverse)
require(tigerstats)
require(forcats)
FinalDat <-read.csv(file="finalSumr2024.csv",header=TRUE)
#recode to remove the annoying "X" from the dataframe
FinalData <- FinalDat  %>% select(-one_of("X"))
FinalData <- FinalData %>%
mutate(across(where(is.character), as.factor))
M = filter(FinalData, sex =="M")
F = filter(FinalData, sex =="F")
LGBTQ = filter(FinalData, LGBTQ =="gay")
DrugUser = filter(FinalData, DrugUser =="yes")
```

# Introduction

A new  preventative vaccine (covid921) is under test in clinical trials. Given the nature of this vaccine it is suspected that the drug may exhibit different effectiveness across the variety of subpopulations tracked. Consider population subgroups by gender( guys and gals), drug use, and sexual orientation. Write a complete report that separately considers this drug for each subgroup and your recommendations as to whether people in the subgroup should take the vaccine. Structure your report in four sections each devoted to one of the four subgroups, use null and alternative hypothesis statements and correct statistical verbage when referencing p-values in conclusions.


First we will need to seperate the groups in two factors, Male(M), Female(F), Gay(LGBTQ), and Drug users(Druguser)

We'll be graphing and comparing who was prescribed either placebo or the vaccine, and weather it was effective or not on who got COVID-19 and who did not.

## Males

### Barplot(Males)

```{r}
dd2 <- M %>% group_by(infected,treatment) %>% summarize(count=n()) %>% mutate(prcnt=count/sum(count))


# the group_by followed by summarize(count=n())

basicC <- ggplot(dd2,aes(x=infected,y=count,fill=treatment))
basicC + geom_bar(stat="identity",position="dodge")

#Now for percentage plot

basicCC <- ggplot(dd2,aes(x=infected,y=prcnt*100,fill=treatment)) 
basicCC + geom_bar(stat="identity", position = "dodge")
```

The Graph above shows the outcome of who was infected even after taking the placebo and/or vaccine respectfully 


From the graph above we can see a clear difference in the count of people who were infected when taking the placebo vs the vaccine. about 74% of The guys who took the placebo still got COVID-19, while comparing to the 27% of guys who got the vaccine who had covid.

This graph shows that Males should recommend getting the vaccine over placebo due to the risk placebo shows of still getting covid.



### Numerical resuts (Male)

```{r}
table1 <- xtabs(~infected + treatment, data=M)
rowPerc(table1)
colPerc(table1)
```

Above we can see 26% of the people who got the vaccine still ended up getting covid, while 74% of them that took placebo got it. Looking at the percentages its a 3:1 ratio for people to get covid with placebo treatment compared to vaccine.


### Inferential (Male)

```{r}
chisq.test(table1)
chisqtestGC(table1)
Mfish <- fisher.test(table1)
Mfish
```

Based on the data provided, the Covid vaccine appears to be associated with a higher likelihood of contracting Covid-19 among male participants. further backing up my statement on how males should take the vaccine over placebo.

## Females

### Barplot(Female)

```{r}
dd2 <- F %>% group_by(infected,treatment) %>% summarize(count=n()) %>% mutate(prcnt=count/sum(count))


# the group_by followed by summarize(count=n())

basicC <- ggplot(dd2,aes(x=infected,y=count,fill=treatment))
basicC + geom_bar(stat="identity",position="dodge")

#Now for percentage plot

basicCC <- ggplot(dd2,aes(x=infected,y=prcnt*100,fill=treatment)) 
basicCC + geom_bar(stat="identity", position = "dodge")
```

I'm not surprised when I look above at our data on the gals, its almost identical to the guys! However looking at the percentage it looks like half the gals who took placebo (65%) still got infected compared to the gals that took the vaccine (35%).

### Numerical resuts (Female)

```{r}
table1 <- xtabs(~infected + treatment, data=F)
rowPerc(table1)
colPerc(table1)
```

The data above shows that females who received the Covid vaccine had a lowerchance of Covid-19 infections compared to those who received the placebo. This reduction in infection rates supports the conclusion that the Covid vaccine is effective and should be recommended for females.


### Inferential (Female)

```{r}
chisq.test(table1)
chisqtestGC(table1)
Ffish <- fisher.test(table1)
Ffish
```

The vaccine appears to significantly reduce the risk of infection compared to the placebo, with the odds ratio of 4 times supporting this conclusion.

## LGBTQ

### Barplot(LGBTQ)

```{r}
dd2 <- LGBTQ %>% group_by(infected,treatment) %>% summarize(count=n()) %>% mutate(prcnt=count/sum(count))


# the group_by followed by summarize(count=n())

basicC <- ggplot(dd2,aes(x=infected,y=count,fill=treatment))
basicC + geom_bar(stat="identity",position="dodge")

#Now for percentage plot

basicCC <- ggplot(dd2,aes(x=infected,y=prcnt*100,fill=treatment)) 
basicCC + geom_bar(stat="identity", position = "dodge")
```

From the graph above we can see that 80% of the LGBTQ that took the placebo still got covid compared to the 20% of LGBTQ that took the vaccine. 

### Numerical resuts (LGBTQ)

```{r}
table1 <- xtabs(~infected + treatment, data=LGBTQ)
rowPerc(table1)
colPerc(table1)
```

Based on the percentages, the vaccine appears to be effective, as it is associated with a lower percentage of infected individuals (20%) compared to the placebo (80%). 

### Inferential (LGBTQ)

```{r}
chisq.test(table1)
chisqtestGC(table1)
LGBTQfish <- fisher.test(table1)
LGBTQfish
```

This test reveal a significant relationship between both vaccine vs. placebo and infection status. Specifically, those in the vaccine group have a higher rate of COVID-19 infections compared to those in the placebo group.

## Druggies

### Barplot(DrugUser)

```{r}
dd2 <- DrugUser %>% group_by(infected,treatment) %>% summarize(count=n()) %>% mutate(prcnt=count/sum(count))


# the group_by followed by summarize(count=n())

basicC <- ggplot(dd2,aes(x=infected,y=count,fill=treatment))
basicC + geom_bar(stat="identity",position="dodge")

#Now for percentage plot

basicCC <- ggplot(dd2,aes(x=infected,y=prcnt*100,fill=treatment)) 
basicCC + geom_bar(stat="identity", position = "dodge")
```

Holy- That doesn't look good for the vaccine, over 91% of the drug users get Covid while 8% of the placebo users get covid. Maybe all the drugs that the drug users take could have an effect on why the vaccine isnt working?

### Numerical resuts (DrugUser)

```{r}
table1 <- xtabs(~infected + treatment, data=DrugUser)
rowPerc(table1)
colPerc(table1)
```

The vaccine appears to be associated with a slightly higher rate of COVID-19 infections compared to the placebo, which is unusual. Typically, one would expect the vaccine to reduce COVID-19 infection rates.

### Inferential (DrugUser)

```{r}
chisq.test(table1)
chisqtestGC(table1)
DrugUserfish <- fisher.test(table1)
DrugUserfish
```

The odds suggests that, compared to the placebo group, those in the vaccine group are about 4.27 times more likely to experience COVID-19 infections.


# Overall Results and Conclusions

From this data of the 4 groups, who should take the vaccine? The drug users should avoid the vaccine as the vaccine group has a percentage of 3.61% infections compared to 0.33% in the placebo group. The Male group seems beneficial for the group to take the vaccine as it has a lower infection rate (1.02%) compared to the placebo (2.82%). Additionally, a higher percentage of individuals in the vaccine group remain 98.98% uninfected compared to the placebo 97.18% group. It would also be a good idea for females to take the vaccine as the infection rate in the vaccine group which is 1.4% is lower than that in the placebo group which is 2.57%. This suggests that the vaccine is effective at reducing the risk of infection. the LGBTQ groups should strongly consider taking the vaccine over the placebo as it shows a clear benefit in preventing infections. The infection rate in the vaccine group (0.77%) is substantially lower than that in the placebo group (3.2%). This indicates that the vaccine is highly effective at reducing the risk of infection.